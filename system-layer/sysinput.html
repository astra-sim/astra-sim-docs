

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Input Files for Collective API &mdash; ASTRA-sim 2.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f35be339"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Network Backend" href="../network-backend/network-backend.html" />
    <link rel="prev" title="Collective Implementation" href="collective-implementation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ASTRA-sim
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workload-layer/workload-layer.html">Workload Layer</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="system-layer.html">System Layer</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="collective-scheduler.html">Collective Scheduler</a></li>
<li class="toctree-l2"><a class="reference internal" href="collective-implementation.html">Collective Implementation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Input Files for Collective API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#astra-sim-native">ASTRA-sim Native</a></li>
<li class="toctree-l3"><a class="reference internal" href="#collective-api">Collective API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#generating-chakra-et-representation-from-collective-tools">Generating Chakra ET Representation from Collective Tools</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../network-backend/network-backend.html">Network Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compute-backend/compute-backend.html">Compute Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote-memory-backend/remote-memory-backend.html">Remote Memory Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation/validation.html">Validation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ASTRA-sim</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="system-layer.html">System Layer</a></li>
      <li class="breadcrumb-item active">Input Files for Collective API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/system-layer/sysinput.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="input-files-for-collective-api">
<h1>Input Files for Collective API<a class="headerlink" href="#input-files-for-collective-api" title="Link to this heading"></a></h1>
<p>This section describes specific pointers to the collective API within the system layer input.
For a general description of the other items in the system layer input, please refer to the <a class="reference external" href="https://astra-sim.github.io/astra-sim-docs/getting-started/argument-system-config.html">Argument ${SYSTEM_CONFIG}</a> page.
For a detailed explanation of the behavior of the system layer, please refer to the previous sections.</p>
<section id="astra-sim-native">
<h2>ASTRA-sim Native<a class="headerlink" href="#astra-sim-native" title="Link to this heading"></a></h2>
<p>Let’s briefly take note of an example of the system layer input using the astra-sim native implementation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
  <span class="s2">&quot;active-chunks-per-dimension&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;all-reduce-implementation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ring&quot;</span><span class="p">],</span>
  <span class="s2">&quot;all-gather-implementation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ring&quot;</span><span class="p">,</span> <span class="s2">&quot;doubleBinaryTree&quot;</span><span class="p">],</span>
  <span class="s2">&quot;all-to-all-implementation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ring&quot;</span><span class="p">,</span> <span class="s2">&quot;doubleBinaryTree&quot;</span><span class="p">,</span> <span class="s2">&quot;halvingDoubling&quot;</span><span class="p">],</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Note the values of the <code class="docutils literal notranslate"><span class="pre">all-*-implementation</span></code> items. These entries point to how the simulator will decompose the given collective into send and receive messages. Two entries in the list mean the simulator will break down the All Gather across two dimensions - the first dimension uses the ring algorithm and the second dimension uses the double binary algorithm. Note that repeated entries such as <code class="docutils literal notranslate"><span class="pre">[&quot;ring&quot;,</span> <span class="pre">&quot;ring&quot;]</span></code> are also possible. How the physical nodes are broken down into each dimension is defined by the network backend. For now, the native implementation requires that the dimensions for collective algorithsm are same across all collectives. The above example, where AllReduce is a 1D collective but AllGather is a 2D collective is simply an illustrative example.</p>
<p>The mapping between each string value and the corresponding simulator code can be found in the <a class="reference external" href="https://github.com/astra-sim/astra-sim/blob/92fc71a71752f4e38d92c7d03a44829114d70143/astra-sim/system/Sys.cc#L468">generate_collective_impl_from_input</a> function.</p>
</section>
<section id="collective-api">
<h2>Collective API<a class="headerlink" href="#collective-api" title="Link to this heading"></a></h2>
<p>The below is an example of the system input using the Collective API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
    <span class="s2">&quot;active-chunks-per-dimension&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;all-reduce-implementation-chakra&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/app/hoti2024/demo5/inputs/custom_ring&quot;</span><span class="p">],</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Note some differences:
First, we use the key <code class="docutils literal notranslate"><span class="pre">all-*-implemenation-chakra</span></code> instead of <code class="docutils literal notranslate"><span class="pre">all-*-implemenation</span></code>. Note how the Chakra ET files refereed here is different from the workload file passed to the workload layer. The value in each item is the absolute path to the Chakra ET files, excluding the last <code class="docutils literal notranslate"><span class="pre">{rank}.et</span></code> string (this is similar to the Workload layer input). Also, even if there are many ‘dimensions’, the list only accepts one value. This is because the notion of cross-dimension communication is already included in the Chakra ET.</p>
<section id="generating-chakra-et-representation-from-collective-tools">
<h3>Generating Chakra ET Representation from Collective Tools<a class="headerlink" href="#generating-chakra-et-representation-from-collective-tools" title="Link to this heading"></a></h3>
<p>We now talk about obtaining the Chakra ET files to define the collective algorithm.</p>
<section id="mscclang">
<h4>MSCCLang<a class="headerlink" href="#mscclang" title="Link to this heading"></a></h4>
<p>The MSCCLang Domain Specific Language (DSL) allows users to easily and expressively write arbitrary, custom collective algorithms.
For a more detailed explanation into the MSCCLang DSL, please refer to their paper at [1].
First, we lower the MSCCLang DSL program into an Intermediate Representation (IR) called MSCCL-IR, which is in XML format.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>git clone git@github.com:jinsun-yoo/msccl-tools.git
cd msccl-tools/examples/mscclang
python3 allreduce_a100_ring.py ${NUM_GPUS} 1 1 &gt; allreduce_ring.xml
</pre></div>
</div>
<p>Then, we convert this into a Chakra ET that ASTRA-sim’s collective API can understand.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>git clone git@github.com:astra-sim/collectiveapi.git
cd chakra_converter

python3 et_converter.py \
    --input_type msccl \
    --input_filename ${FILEPATH}/allreduce_ring.xml \
    --output_filename allreduce_ring_mscclang \
    --coll_size 1048576

ls allreduce_ring_mscclang*
allreduce_ring_mscclang.0.et  allreduce_ring_mscclang.1.et  allreduce_ring_mscclang.2.et  allreduce_ring_mscclang.3.et
...
</pre></div>
</div>
<p>Note how we have to provide the communication size to the converter. This is a current limit where we have to hardcode the collective size into the algorithm, and ignore the collective size of the Chakra ET in the workload layer. We will release an update shortly to fix this limitation.</p>
</section>
<section id="tacos">
<h4>TACOS<a class="headerlink" href="#tacos" title="Link to this heading"></a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This page is currently under construction. Please stay tuned for updates!</p>
</div>
<p><strong>Reference</strong>
[1] Meghan Cowan, et al. “MSCCLang: Microsoft Collective Communication Language.”, In Proceedings of ASPLOS 2023, https://doi.org/10.1145/3575693.3575724</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="collective-implementation.html" class="btn btn-neutral float-left" title="Collective Implementation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../network-backend/network-backend.html" class="btn btn-neutral float-right" title="Network Backend" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2024, Synergy Lab, Georgia Institute of Technology.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Read the Docs</span>
        v: latest
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        
        <dl>
            <dt>Versions</dt>
            
            
                <dd><a href="/astra-sim-docs/1.0/index.html">1.0</a></dd>
                
            
            
                <dd><a href="/astra-sim-docs/2.2/index.html">2.2</a></dd>
                
            
            
                <dd><a href="/astra-sim-docs/index.html">latest</a></dd>
                
            
        </dl>
        
    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>